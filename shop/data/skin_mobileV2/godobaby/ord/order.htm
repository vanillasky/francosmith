{*** 주문하기(주문서작성) | ord/order.php ***}
{ # header }

<?php {page_title} = "주문하기";?>
{#sub_header}
<style type="text/css">
section#m_order{background:#FFFFFF;}

section#nm_order {background:#FFFFFF; padding:12px;font-family:dotum;font-size:12px;}
section#nm_order .sub_title{height:22px; line-height:22px; color:#436693; font-weight:bold; font-size:12px;}
section#nm_order .sub_title .point {width:4px; height:22px; background:url('../common/img/bottom/icon_guide.png') no-repeat center left; float:left; margin-right:7px;}
section#nm_order table{border:none; border-top:solid 1px #dbdbdb;width:100%; margin-bottom:20px;}
section#nm_order table td{padding:8px 0px 8px 10px; vertical-align:middle; border-bottom:solid 1px #dbdbdb;}
section#nm_order table th{text-align:center; background:#f5f5f5; width:70px; vertical-align:middle; border-bottom:solid 1px #dbdbdb; color:#353535; font-size:12px;}
section#nm_order table .img{padding:5px; width:60px;}
section#nm_order table .img img{border:solid 1px #d9d9d9;}
section#nm_order table td input[type=text], input[type=password], input[type=email], input[type=number], select{height:21px;}

section#nm_order table td.phone input[type=number]{width:45px;height:21px;}
section#nm_order table td.zipcode input[type=text]{width:60px;height:21px;}
section#nm_order table td.zipcode input[type=number]{width:30px;height:21px;}
section#nm_order table td.zipcode #zonecode {width:45px;height:21px;}
section#nm_order table td.coupon input[type=number]{width:100px;height:21px;}
section#nm_order table td.emoney input[type=number]{width:100px;height:21px;}
section#nm_order table td textarea{width:95%;height:116px;}
section#nm_order .btn_center {margin:auto; width:198px; height:34px; margin-top:20px; margin-bottom:20px;}
section#nm_order .btn_center .btn_payment{border:none; background:#f35151; color:#FFFFFF; font-size:14px; width:94px; height:34px; float:left; font-family:dotum; line-height:34px; border-radius:3px;}
section#nm_order .btn_center .btn_prev{border:none; background:#808591;  color:#FFFFFF; font-size:14px; width:94px; height:34px; float:right; font-family:dotum; line-height:34px; border-radius:3px;}
section#nm_order .goods-nm{color:#353535; font-weight:bold; fonst-size:14px; margin-bottom:5px; overflow:hidden;text-overflow:ellipsis;white-space:nowrap; }
section#nm_order .goods-price{color:#f03c3c; font-size:12px;}
#zipcode_list ul {list-style:none;}
#zipcode_list li {padding:5px; 0px;}
.btn_zipcode {background:#808591; width:73px; height:25px; border:none; color:#FFFFFF; text-align:center; margin-left:10px;line-height:25px; border-radius:3px;vertical-align:middle;}
.coupon-btn-area {margin-bottom:10px;}
.btn_coupon {background:#808591; width:73px; height:25px; border:none; color:#FFFFFF; text-align:center; margin-right:10px;line-height:25px; border-radius:3px;}
.max_width{width:95%;}

section#nm_order #couponListTable th:first-child		{ width: 15%; }
section#nm_order #couponListTable th:last-child			{ width: 25%; }
section#nm_order #couponListTable td:nth-child(1)		{ text-align: center; padding-left:0px; }
section#nm_order #couponListTable td:nth-child(2) div	{ width: 100%;}
section#nm_order #couponListTable td:nth-child(3)		{ text-align: center; padding-left:0px; }

/* 모바일전용, 무통장전용 쿠폰*/
section#nm_order #couponListTable td:nth-child(2) div.couponInfoOnlyBtn { height: 23px; }
section#nm_order #couponListTable td:nth-child(2) div.couponInfoOnlyBtn div.onlyMobileCouponBtn{ float: left; margin:0px 3px 3px 0px; width: 55px; height: 15px; color: #ffffff; font-size: 9px; -webkit-border-radius: 5px; -moz-border-radius: 5px; border-radius: 5px; background-color: #56ca81; font-weight: bold; text-align: center; line-height: 15px; }
section#nm_order #couponListTable td:nth-child(2) div.couponInfoOnlyBtn div.onlyBankBookCouponBtn	{ float: left; margin:0px 3px 3px 0px; width: 55px; height: 15px; color: #ffffff; font-size: 9px; -webkit-border-radius: 5px; -moz-border-radius: 5px; border-radius: 5px; background-color: #7b9ff0; font-weight: bold; text-align: center; line-height: 15px; }
.delivery_radio { height:30px; line-height:30px; }
.delivery_select { height:30px; line-height:30px; }
#delivery_list { width:100%; }
.dark_gray { background:#B9B9B9 !important; }
</style>


<!--{ NaverMileageScript }-->
<script id="delivery"></script>
<form id="form" name="frmOrder" action="settle.php" method="post" onsubmit="return chkForm2(this)">
<input type="hidden" name="ordno" value="{ordno}">
<input type="hidden" name="couponVersion" id="couponVersion" value="{couponVersion}">
<div id="apply_coupon"></div>
<section id="m_order" class="content">
<!--{ @ cart->item }-->
<input type="hidden" name=item_apply_coupon[]>
<!--{ / }-->
<!--{ = include_file( "proc/orderitem.htm" ) }-->
</section>
<section id="nm_order" class="content">

<!--{ ? !_sess }-->
<!-- 개인정보 수집 동의 -->
<div class="sub_title"><div class="point"></div>개인정보 수집 동의</div>
<div style="padding-top: 10px; background: #f1f1f1; margin-bottom: 20px;">
	<div style="font-size: 11px; padding: 5px;">
		<span style="font-weight: bold;">● 비회원 주문에 대한 개인정보 수집에 대한 동의</span>
		<span>(자세한 내용은 “<a href="../service/private.php">개인정보처리방침</a>”을 확인하시기 바랍니다)</span>
	</div>
	<div class="agreement-content" style="height: 100px; overflow-y: scroll; border: solid #dddddd 1px; background: #ffffff; padding: 5px;">
		{termsPolicyCollection3}
	</div>
	<div style="text-align: center; padding: 5px;">
		<input id="guest-private-agreement" type="hidden"/>
		<input id="private-agree" type="radio" name="private" value="y"/>
		<label for="private-agree">동의합니다</label>
		<input id="private-disagree" type="radio" name="private" value=""/>
		<label for="private-disagree">동의하지 않습니다</label>
	</div>
</div>
<!--{ / }-->

<!-- 01 주문자정보 -->
<div class="sub_title"><div class="point"></div>주문자정보</div>
<table>
	<tr>
		<th>주문자명</th>
		<td>
			<input type="text" name="nameOrder" value="{name}" {_style_member} required msgR="주문하시는분의 이름을 적어주세요" class="max_width"/>
		</td>
	</tr>
	<!--{ ? address }-->
	<tr>
		<th>주소</th>
		<td>
			{address}<br />{address_sub}
			<!--{ ? road_address }--><div style="padding-top:5px;font:12px dotum;color:#999;">{road_address} {address_sub}</div><!--{ / }-->
		</td>
	</tr>
	<!--{ / }-->
	<tr>
		<th>전화번호</th>
		<td class="phone">
			<input type="number" name="phoneOrder[]" value="{phone[0]}" size="3" maxlength="3" required /> -
			<input type="number" name="phoneOrder[]" value="{phone[1]}" size="4" maxlength="4" required /> -
			<input type="number" name="phoneOrder[]" value="{phone[2]}" size="4" maxlength="4" required />
		</td>
	</tr>
	<tr>
		<th>휴대폰</th>
		<td class="phone">
			<input type="number" name="mobileOrder[]" value="{mobile[0]}" size="3" maxlength="3" required /> -
			<input type="number" name="mobileOrder[]" value="{mobile[1]}" size="4" maxlength="4" required /> -
			<input type="number" name="mobileOrder[]" value="{mobile[2]}" size="4" maxlength="4" required />
		</td>
	</tr>
	<tr>
		<th>이메일</th>
		<td class="email">
			<input type="text" name="email" value="{email}" required option=regEmail class="max_width" />
		</td>
	</tr>
</table>
<div class="sub_title"><div class="point"></div>배송정보</div>
<table>
	<!--{ ? _sess }-->
	<tr>
		<th>배송지<br />선택</th>
		<td>
			<div class="delivery_radio">
				<input type="radio" name="deli_select" id="deli_select1" value="1" onclick="ctrl_field(1)" checked /><label for="deli_select1"> 기본 배송지</label>
				<input type="radio" name="deli_select" id="deli_select2" value="2" onclick="ctrl_field(2)" /><label for="deli_select2"> 최근 배송지</label>
				<input type="radio" name="deli_select" id="deli_select3" value="3" onclick="ctrl_field(0)" /><label for="deli_select3"> 신규 배송지</label>
			</div>
			<div class="delivery_select">
				<select name="delivery_list" id="delivery_list">
					<option value="">배송지 목록에서 선택</option>
					<!--{ @ list }-->
					<option value="{.gmd_sno}">
						<!--{ ? .gmd_road_address }-->
						{.gmd_road_address}
						<!--{ : }-->
						{.gmd_address}
						<!--{ / }-->
						{.gmd_address_sub}
					</option>
					<!--{ / }-->
				</select>
			</div>
		</td>
	</tr>
	<!--{ : }-->
	<tr>
		<th>배송지</th>
		<td>
			<label><input type="checkbox" onclick="ctrl_field(this.checked)" {?_sess}checked{/} /> 주문고객 정보와 동일합니다</label>
		</td>
	</tr>
	<!--{ / }-->
	<tr>
		<th>받으실분</th>
		<td>
			<input type="text" name="nameReceiver" value="{name}" required class="max_width clear readonlyCheck" fld_esssential label="받으실분" />
		</td>
	</tr>
	<tr>
		<th>우편번호</th>
		<td class="zipcode">
			<div>
			<input type="number" class="zonecode clear readonlyCheck" name="zonecode" id="zonecode" size="5" readonly value="{zonecode}" />
			( <input type="number" name="zipcode[]" id="zipcode0" size=3 readonly value="{zipcode[0]}" required class="clear readonlyCheck" /> -
			<input type="number" name="zipcode[]" id="zipcode1" size=3 readonly value="{zipcode[1]}" required class="clear readonlyCheck" /> )
			<button id="zipcode-btn" class="btn_zipcode" type="button" onclick="frmMake('{_cfg.rootDir}/proc/popup_address.php?isMobile=true&gubun=mobile','searchZipcode','',false)" <!--{ ? _sess }-->style="display:none;"<!--{ / }-->>우편번호</button>
			</div>
		</td>
	</tr>
	<tr>
		<td colspan="2">

		</td>
	</tr>
	<tr>
		<th>주소</th>
		<td>
			<div><input type="text" name="address" id="address" value="{address}" readonly required class="max_width clear readonlyCheck" onFocus="search_zipcode();this.blur();" fld_esssential label="주소" /></div>
		</td>
	</tr>
	<tr>
		<th>세부주소</th>
		<td>
			<input type="text" name="address_sub" id="address_sub" value="{address_sub}"  label="세부주소" class="max_width clear readonlyCheck" label="세부주소" onkeyup="SameAddressSub(this)" oninput="SameAddressSub(this)"/>
			<input type="hidden" name="road_address" id="road_address" style="width:100%" value="{road_address}" class="line clear">
			<div style="padding:5px 5px 0 1px;font:12px dotum;color:#999;" id="div_road_address">{road_address}</div>
			<div style="padding:5px 0 0 1px;font:12px dotum;color:#999;" id="div_road_address_sub"><!--{ ? road_address }-->{address_sub}<!--{ / }--></div>
		</td>
	</tr>
	<tr>
		<th>전화번호</th>
		<td class="phone">
			<input type="number" name="phoneReceiver[]" value="{phone[0]}" pattern="[0-9]*" min="000" max="999" maxlength="3" class="clear readonlyCheck" /> -
			<input type="number" name="phoneReceiver[]" value="{phone[1]}" pattern="[0-9]*" min="0000" max="9999" maxlength="4" class="clear readonlyCheck" /> -
			<input type="number" name="phoneReceiver[]" value="{phone[2]}" pattern="[0-9]*" min="0000" max="9999" maxlength="4" class="clear readonlyCheck" />
		</td>
	</tr>
	<tr>
		<th>휴대폰</th>
		<td class="phone">
			<input type="number" name="mobileReceiver[]" value="{mobile[0]}" pattern="[0-9]*" min="000" max="999" maxlength="3" required fld_esssential label="받으실분 휴대폰번호" class="clear readonlyCheck" /> -
			<input type="number" name="mobileReceiver[]" value="{mobile[1]}" pattern="[0-9]*" min="0000" max="9999" maxlength="4" required fld_esssential label="받으실분 휴대폰번호" class="clear readonlyCheck" /> -
			<input type="number" name="mobileReceiver[]" value="{mobile[2]}" pattern="[0-9]*" min="0000" max="9999" maxlength="4" required fld_esssential label="받으실분 휴대폰번호" class="clear readonlyCheck" />
		</td>
	</tr>
	<tr>
		<th>메시지</th>
		<td>
			<textarea name="memo">{memo}</textarea>
		</td>
	</tr>
	<tr id="delivery_check" style="display:none;">
		<th>회원정보<br/>반영</th>
		<td>
			<input type="checkbox" name="delivery_add" id="delivery_add" value="y" /><label for="delivery_add">배송지 목록에 추가</label>
			<input type="checkbox" name="delivery_default" id="delivery_default" value="y" /><label for="delivery_default">기본 배송지로 선택</label>
		</td>
	</tr>
</table>

<div class="sub_title"><div class="point"></div>배송선택</div>
<table>
	<tr>
		<th>배송선택</th>
		<td>
			<div><input type="radio" name="deliPoli" value="0" checked onclick="getDelivery()" onblur="chk_emoney(document.frmOrder.emoney)" /> 기본배송</div>
			<!--{ @ _r_deli}-->
			<!--{? .value_ }-->
			<div><input type="radio" name="deliPoli" value="{.index_ + 1}" onclick="getDelivery()" onblur="chk_emoney(document.frmOrder.emoney)" /> {.value_}</div>
			<!--{ / }-->
			<!--{ / }-->
		</td>
	</tr>
</table>

<div class="sub_title"><div class="point"></div>결제금액</div>
<table>
	<tr>
		<th>합계금액</th>
		<td>
			<span id="paper_goodsprice">{=number_format(cart->goodsprice)}</span> 원
		</td>
	</tr>
	<tr>
		<th>배송비</th>
		<td>
			<div id="paper_delivery_msg1"><span id="paper_delivery"></span> 원</div>
			<div id="paper_delivery_msg2"></div>
			<div id="paper_delivery_msg_extra" style="display:none;"></div>
		</td>
	</tr>
	<!--{ ? cart->special_discount_amount }-->
	<tr>
		<th>상품할인</th>
		<td><span id='special_discount_amount' style="width:145;text-align:right">{=number_format(cart->special_discount_amount)}</span> 원</td>
	</tr>
	<!--{ / }-->
	<!--{ ? _sess }-->
	<tr>
		<th>회원할인</th>
		<td>
			<span id='memberdc'>{=number_format(cart->dcprice)}</span> 원
		</td>
	</tr>
	<tr>
		<th>쿠폰적용</th>
		<td class="coupon">
			<div class="coupon-btn-area">
				<button class="btn_coupon" type="button" onClick="removeCoupon();">쿠폰취소</button>
				<button class="btn_coupon" type="button" onClick="getCoupon();">쿠폰조회</button>
			</div>
			<div id="coupon_list"></div>
			<div style="height:32px;">할인:<input type="text" id="coupon" name="coupon" size="5" style="text-align:right" value="0" readonly> 원</div>
			<div style="height:32px;">적립:<input type="text" id="coupon_emoney" name="coupon_emoney" size="5" style="text-align:right" value="0" readonly> 원</div>
			<div style="color:#436693;">
				* 정상적으로 결제가 완료되지 않은 주문에 사용한 쿠폰은 [마이페이지] > [주문내역] > [상세보기] 페이지에서 쿠폰 사용 취소 후 다시 사용하실 수 있습니다.
			</div>
		</td>
	</tr>
	<tr>
		<th>적립금</th>
		<td class="emoney">
			<input type="text" name="emoney"  size="5" style="text-align:right" value="0" onblur="chk_emoney(this);" onkeyup="calcu_settle();" onkeydown="if (event.keyCode == 13) {return false;}" { ? _set.emoney.totallimit > cart->goodsprice }disabled{/}> 원 (보유적립금 : {=number_format(_member.emoney)}원)

			<!--{ ? _member.emoney < _set.emoney.hold }-->

			<div style="font-size:12px;color:#436693;margin-top:7px;">
			보유적립금이 {=number_format(_set.emoney.hold)}원이상 일 경우 사용하실 수 있습니다.
			</div>
			<!--{ ? _set.emoney.totallimit > cart->goodsprice }-->
			<div style="font-size:12px;color:#436693;margin-top:7px;">
			{=number_format(_set.emoney.totallimit)}원 이상 주문시 적립금 사용 가능.
			</div>
			<!--{ / }-->


			<!--{ : }-->

			<div style="font-size:12px;color:#436693;margin-top:7px;">
				<!--{ ? _emoney_max && _emoney_max >= _set.emoney.min}-->
				{=number_format(_set.emoney.min)}원부터 <span id=print_emoney_max>{=number_format(_emoney_max)}</span>원까지 사용이 가능합니다.
				<!--{ : _emoney_max && _emoney_max < _set.emoney.min}-->
				최소 {=number_format(_set.emoney.min)}원 이상 사용하여야 합니다.
				<!--{ : !_emoney_max }-->
				보유적립금만큼 사용가능합니다.
				<!--{ / }-->
			</div>

		<!--{ / }-->
			<input type="hidden" name="emoney_max" value="{ _emoney_max }">
		</td>
	</tr>
	<!--{ / }-->
	<!--{ ? NaverMileageForm2 }-->
	<tr>
		<td colspan="3">
		<!--{ NaverMileageForm2 }-->
		</td>
	</tr>
	<!--{/}-->
	<tr>
		<th>결제금액</th>
		<td>
			<span id=paper_settlement style="width:146px;text-align:right; color:FF6C68;">{=number_format(cart->totalprice-cart->dcprice-cart->special_discount_amount)}</span> 원
		</td>
	</tr>
</table>


<div class="sub_title"><div class="point"></div>결제수단</div>
<table>
	<tr>
		<th>결제수단</th>
		<td>
			<input type="hidden" name="escrow" value="N" />
			<!--{ ? Payco }-->
			<div><label><input type=radio name=settlekind value="t" onclick="input_escrow(this,'N')" style="height:30px"/>{Payco}</label></div>
			<!--{ / }-->
			<!--{ ? _set.use.a }-->
			<div><label><input type=radio name=settlekind value="a" onclick="input_escrow(this,'N')" style="height:30px"/>무통장입금</label></div>
			<!--{ / }-->
			<!--{ ? _set.use_mobile.c }-->
			<div><label><input type=radio name=settlekind value="c" onclick="input_escrow(this,'N')" style="height:30px"/>신용카드</label></div>
			<!--{ / }-->
			<!--{ ? _set.use_mobile.v }-->
			<div><label><input type=radio name=settlekind value="v" onclick="input_escrow(this,'N')" style="height:30px"/>가상계좌</label></div>
			<!--{ / }-->
			<!--{ ? _set.use_mobile.h }-->
			<div><label><input type=radio name=settlekind value="h" onclick="input_escrow(this,'N')" style="height:30px"/>핸드폰</label></div>
			<!--{ / }-->

			<!--{ ? _escrow.use=='Y' && _cfg['settlePg']==_escrow.pg && cart->totalprice-cart->dcprice>=_escrow.min }-->
			<!--{ ? _escrow.c }-->
			<div><label><input type=radio name=settlekind value="c" onclick="input_escrow(this,'Y')" style="height:30px"/>에스크로 신용카드</label></div>
			<!--{ / }-->
			<!--{ ? _escrow.v }-->
			<div><label><input type=radio name=settlekind value="v" onclick="input_escrow(this,'Y')" style="height:30px"/>에스크로 가상계좌</label></div>
			<!--{ / }-->
			<!--{ / }-->
		</td>
	</tr>
</table>

<!--{ ? _pg_mobile.receipt=='Y' && _set.receipt.order=='Y' }-->
<!-- 05 현금영수증발행 -->
<div  id="cash">
<div class="sub_title"><div class="point"></div>현금영수증발행</div>
<!--{ = include_file( "proc/_cashreceiptOrder.htm" ) }-->
</div>
<!--{ / }-->

<!--{ ? _cfg.orderDoubleCheck == 'y' }-->
<div class="sub_title"><div class="point"></div>구매내용확인</div>
<table>
	<tr>
		<th>구매내용확인</th>
		<td class="noline">
			<input type="checkbox" name="doubleCheck" value="y" required fld_esssential label="구매내용확인" msgR="구매 내용에 동의하셔야 결제가 가능합니다." />
			구매하실 상품의 상품정보 및 가격을 확인하였으며, 이에동의합니다. (전자상거래법 제8조 제2항)
		</td>
	</tr>
</table>
<!--{ / }-->

<div class="m_ord">
<div class="btn_center">
	<div class="btn_pay"><button type="submit" id="payment-btn" class="btn_payment">결제하기</button></div>
	<div class="btn_pre"><button type="button" id="prev-btn" class="btn_prev"  onclick="history.back();">취소</button></div>
</div>
</div>

</section>

</form>

<div id=dynamic></div>

<script>
$(function () {
	var alwaysReadonly = new Array("zonecode", "zipcode0", "zipcode1", "address");
	var address = "{address}" ;
	var select_delivery = 1;
	<!--{ ? _sess }-->
	if(!address) {
		$('input:radio[name=deli_select]:input[value=3]').attr("checked", true);
		select_delivery = 3;
		ctrl_field(0);
	}
	readonlyEvent();
	<!--{ / }-->
	$("#delivery_list").change(function () {
		$('input:radio[name=deli_select]:input[value=3]').attr("checked", true);
		readonlyEvent();
		if($(this).val()) {
			$.ajax({
				url : "{_cfg.rootDir}/order/order_delivery_indb.php",
				type : "post",
				dataType: "json",
				async : false,
				data : "mode=select&sno="+$(this).val(),
				success : function(res) {
					$("input[name=nameReceiver]").val(res.name);
					$("#zipcode0").val(res.zipcode0);
					$("#zipcode1").val(res.zipcode1);
					$("#zonecode").val(res.zonecode);
					$("#address").val(res.address);
					$("#address_sub").val(res.address_sub);
					$("#road_address").val(res.road_address);
					$("#div_road_address").html(res.road_address);
					$("#div_road_address_sub").html(res.road_address ? res.address_sub : "");
					$("input[name=phoneReceiver[]]:eq(0)").val(res.phone0);
					$("input[name=phoneReceiver[]]:eq(1)").val(res.phone1);
					$("input[name=phoneReceiver[]]:eq(2)").val(res.phone2);
					$("input[name=mobileReceiver[]]:eq(0)").val(res.mobile0);
					$("input[name=mobileReceiver[]]:eq(1)").val(res.mobile1);
					$("input[name=mobileReceiver[]]:eq(2)").val(res.mobile2);
					<!--{ ? _sess }-->
					$("#delivery_check").attr("style", "display:");
					$("#zipcode-btn").attr("style", "display:");
					<!--{ / }-->
					getDelivery();
				}
			});
		} else {
			$(".clear").each(function() {
				$(this).val("");
			});
			$("#div_road_address").html("");
			$("#div_road_address_sub").html("");
			<!--{ ? _sess }-->
			$("#delivery_check").attr("style", "display:");
			$("#zipcode-btn").attr("style", "display:");
			<!--{ / }-->
		}
	});

	$("#delivery_add, #delivery_default").click(function() {
		var _val = $(this).is(":checked");
		if(_val) {
			$.ajax({
				url : "{_cfg.rootDir}/order/order_delivery_indb.php",
				type : "post",
				data : "mode=check",
				dataType: "html",
				success : function(res){
					if(res) {
						alert("등록가능한 배송지를 모두 등록하였습니다.\n배송지 목록 관리는 PC쇼핑몰에서 할 수 있습니다.");
						$("#delivery_add").attr("checked", false);
						$("#delivery_default").attr("checked", false);
					}
				}
			});
		}
	});

	$("input[type=number]").keypress(function (event) {
		onlyNum(event);
		if ($(this).val().length >= $(this).attr("maxlength")) return false;
	}).blur(function () {
		if ($(this).val().length >= $(this).attr("maxlength")) $(this).val($(this).val().substring(0, $(this).attr("maxlength")));
	});
});

function readonlyEvent() {
	var select_delivery = $('input:radio[name=deli_select]:checked').val();
	var alwaysReadonly = new Array("zonecode", "zipcode0", "zipcode1", "address");
	$(".readonlyCheck").each(function() {
		$(this).removeClass("dark_gray");
		if(select_delivery == 1 || select_delivery == 2) {
			$(this).addClass("dark_gray").attr("readonly", true);
		} else {
			$(this).removeClass("dark_gray");
			for(var i=0 ; i<alwaysReadonly.length ; i++) {
				if($(this).attr("id") == alwaysReadonly[i]) {
					$(this).attr("readonly", true);
					break;
				} else {
					$(this).attr("readonly", false);
				}
			}
		}
	});

}

function onlyNum(obj) {
	var ie_11 = /Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent);

	if(ie_11 || !window.event) var _code=arguments[1].which;
	else var _code=event.keyCode;

	if ((_code<48) || (_code>57)) {
		if(ie_11 || !window.event) arguments[1].preventDefault();
		else event.returnValue=false;
	}
	else {
		return true;
	}
}

var emoney_max = {_emoney_max};
function chkForm2(fm)
{
	<!--{ ? _sess }-->
	var select_delivery = $('input:radio[name=deli_select]:checked').val();
	var pass = true;
	if(select_delivery == 1 || select_delivery == 2) {
		$(".readonlyCheck").each(function() {
			if(!$(this).val() && $(this).attr("id") != "zonecode" && $(this).attr("id") != "address_sub") {
				var ment = select_delivery == 1 ? "기본 배송지에 배송에 필요한 항목 중 없는 항목이 있습니다. " : "최근 배송지가 없습니다. ";
				alert(ment+"\n신규 배송지 혹은 배송지 목록에서 배송지를 추가해 주세요.");
				pass = false;
				return false;
			}
		});
	}
	if(!pass) return false;
	<!--{ / }-->

	var guestPrivateAgreement = document.getElementById("guest-private-agreement");
	var privateAgreement = jQuery(fm).find("[name=private]:checked").val();
	if (guestPrivateAgreement != null) {
		if (privateAgreement !== "y") {
			alert("비회원 개인정보 수집에 동의를 하셔야만 주문이 가능합니다.");
			return false;
		}
	}

	if (typeof(fm.settlekind)=="undefined"){
		alert("결제수단이 활성화가 안 되었습니다. 관리자에게 문의하세요.");
		return false;
	}

	var obj = document.getElementsByName('settlekind');
	if (obj[0].getAttribute('required') == undefined){
		obj[0].setAttribute('required', '');
		obj[0].setAttribute('label', '결제수단');
	}
	// 여기에서 쿠폰 제거처리
	var checked_count =0;
	var chks = document.getElementsByName('coupon_[]');
	for (var i=0,m=chks.length;i<m ;i++) {
		if (chks[i].checked == true) {
			checked_count ++;
		}
	}
	// 선택된 쿠폰이 하나도 없다면 , 쿠폰정보를 전부 삭제해야 한다.
	if (checked_count == 0) {
		removeCoupon();
	}

	return chkForm(fm);
}

function input_escrow(obj,val)
{
	obj.form.escrow.value = val;
	if (typeof(cash_required) == 'function') cash_required();
}

function ctrl_field(val)
{
	if (val == 1) copy_field();
	else if (val == 2) last_field();
	else clear_field();
}
function copy_field()
{
	var form = document.frmOrder;
	form.nameReceiver.value = form.nameOrder.value;
	form['zipcode[]'][0].value = "{zipcode[0]}";
	form['zipcode[]'][1].value = "{zipcode[1]}";
	form['zonecode'].value = "{zonecode}";
	form.address.value = "{address}";
	form.address_sub.value = "{address_sub}";
	form.road_address.value = "{road_address}";
	document.getElementById("div_road_address").innerHTML =  "{road_address}";
	document.getElementById("div_road_address_sub").innerHTML =  form.road_address.value ? "{address_sub}" : "";
	form['phoneReceiver[]'][0].value = form['phoneOrder[]'][0].value;
	form['phoneReceiver[]'][1].value = form['phoneOrder[]'][1].value;
	form['phoneReceiver[]'][2].value = form['phoneOrder[]'][2].value;
	form['mobileReceiver[]'][0].value = form['mobileOrder[]'][0].value;
	form['mobileReceiver[]'][1].value = form['mobileOrder[]'][1].value;
	form['mobileReceiver[]'][2].value = form['mobileOrder[]'][2].value;
	form.memo.value = "{memo}";

	<!--{ ? _sess }-->
	document.getElementById("delivery_check").style.display="none";
	document.getElementById("zipcode-btn").style.display="none";
	document.getElementById("delivery_list").options[0].selected = "selected";
	readonlyEvent();
	<!--{ / }-->

	getDelivery();
}
function last_field() 
{
	var form = document.frmOrder;
	form.nameReceiver.value = "{last_name}";
	form['zipcode[]'][0].value = "{last_zipcode[0]}";
	form['zipcode[]'][1].value = "{last_zipcode[1]}";
	form.zonecode.value = "{last_zonecode}";
	form.address.value = "{last_address}";
	form.address_sub.value = "";
	form.road_address.value = "{last_road_address}";
	document.getElementById("div_road_address").innerHTML =  "{last_road_address}";
	document.getElementById("div_road_address_sub").innerHTML = "";
	form['phoneReceiver[]'][0].value = "{last_phone[0]}";
	form['phoneReceiver[]'][1].value = "{last_phone[1]}";
	form['phoneReceiver[]'][2].value = "{last_phone[2]}";
	form['mobileReceiver[]'][0].value = "{last_mobile[0]}";
	form['mobileReceiver[]'][1].value = "{last_mobile[1]}";
	form['mobileReceiver[]'][2].value = "{last_mobile[2]}";

	<!--{ ? _sess }-->
	document.getElementById("delivery_check").style.display="none";
	document.getElementById("zipcode-btn").style.display="none";
	document.getElementById("delivery_list").options[0].selected = "selected";
	readonlyEvent();
	<!--{ / }-->

	getDelivery();
}
function clear_field()
{
	var form = document.frmOrder;
	form.nameReceiver.value = "";
	form['zipcode[]'][0].value = "";
	form['zipcode[]'][1].value = "";
	form['zonecode'].value = "";
	form.address.value = "";
	form.address_sub.value = "";
	form.road_address.value = "";
	document.getElementById("div_road_address").innerHTML =  "";
	document.getElementById("div_road_address_sub").innerHTML =  "";
	form['phoneReceiver[]'][0].value = "";
	form['phoneReceiver[]'][1].value = "";
	form['phoneReceiver[]'][2].value = "";
	form['mobileReceiver[]'][0].value = "";
	form['mobileReceiver[]'][1].value = "";
	form['mobileReceiver[]'][2].value = "";
	form.memo.value = "";

	<!--{ ? _sess }-->
	document.getElementById("delivery_check").style.display="";
	document.getElementById("zipcode-btn").style.display="";
	document.getElementById("delivery_list").options[0].selected = "selected";
	readonlyEvent();
	<!--{ / }-->
}
function cutting(emoney)
{
	var chk_emoney = new String(emoney);
	reg = /({=substr(_set.emoney.base,1)})$/g;
	if (emoney && !chk_emoney.match(reg)){
		emoney = Math.floor(emoney/{_set.emoney.base}) * {_set.emoney.base};
	}
	return emoney;
}
function chk_emoney(obj)
{
	if (typeof obj == 'undefined') {
		calcu_settle();
		return;
	}
	var form = document.frmOrder;
	var my_emoney = {emoney+0};
	var max = '{_set.emoney.max}';
	var min = '{_set.emoney.min}';
	var hold = '{_set.emoney.hold}';

	var delivery	= uncomma(document.getElementById('paper_delivery').innerHTML);
	var goodsprice = uncomma(document.getElementById('paper_goodsprice').innerText);
	<!--{? _set.emoney.emoney_use_range }-->
	var erangeprice = goodsprice + delivery;
	<!--{:}-->
	var erangeprice = goodsprice;
	<!--{/}-->
	var max_base = erangeprice - uncomma(_ID('memberdc').innerHTML) - uncomma(document.getElementsByName('coupon')[0].value);
	if( form.coupon ){
		 var coupon = uncomma(form.coupon.value);
	}
	max = getDcprice(max_base,max,{_set.emoney.base});
	min = parseInt(min);

	if (max > max_base)  max = max_base;
	if( _ID('print_emoney_max') && _ID('print_emoney_max').innerHTML != comma(max)  )_ID('print_emoney_max').innerHTML = comma(max);

	var emoney = uncomma(obj.value);
	if (emoney>my_emoney) emoney = my_emoney;

	// 쿠폰/이머니 중복 사용 체크
	var dup = { ? _set.emoney.useduplicate == '1'}true{:}false{/};
	if (my_emoney > 0 && emoney > 0 && (parseInt(coupon) > 0 || parseInt(coupon_emoney)) > 0 && !dup) {
		alert('적립금과 쿠폰 사용이 중복적용되지 않습니다.');
		emoney = 0;
	}

	if(my_emoney > 0 && emoney > 0 && my_emoney < hold){
		alert("보유적립금이 "+ comma(hold) + "원 이상 일 경우에만 사용하실 수 있습니다.");
		emoney = 0;
	}
	if (min && emoney > 0 && emoney < min){
		alert("적립금은 " + comma(min) + "원 부터  사용이 가능합니다");
		emoney = 0;
	} else if (max && emoney > max && emoney > 0){
		if(emoney_max < min){
			alert("주문 상품 금액이 최소 사용 적립금 " + comma(min) + "원 보다  작습니다.");
			emoney = 0;
		}else{
			alert("적립금은 " + comma(min) + "원 부터 " + comma(max) + "원 까지만 사용이 가능합니다");
			emoney = max;
		}
	}

	obj.value = comma(cutting(emoney));
	calcu_settle();
}

function calcu_settle()
{
	var dc=0;
	var special_discount_amount = 0;
	var coupon = settleprice = 0;
	var goodsprice	= uncomma(document.getElementById('paper_goodsprice').innerHTML);
	var delivery	= uncomma(document.getElementById('paper_delivery').innerHTML);
	if(_ID('memberdc')) dc = uncomma(_ID('memberdc').innerHTML);
	if(_ID('special_discount_amount')) special_discount_amount = uncomma(_ID('special_discount_amount').innerHTML);
	var emoney = (document.frmOrder.emoney) ? uncomma(document.frmOrder.emoney.value) : 0;
	if (document.frmOrder.coupon){
		coupon = uncomma(document.frmOrder.coupon.value);
		if (goodsprice + delivery - dc - coupon - emoney < 0){
			<!--{? _set.emoney.emoney_use_range }-->
			emoney = goodsprice + delivery - dc - coupon - special_discount_amount;
			<!--{:}-->
			emoney = goodsprice - dc - coupon - special_discount_amount;
			<!--{/}-->
			document.frmOrder.emoney.value = comma(cutting(emoney));
		}
		dc += coupon + emoney;
	}
	var settlement = (goodsprice + delivery - dc - special_discount_amount);
	<!--{ NaverMileageCalc }-->
	document.getElementById('paper_settlement').innerHTML = comma(settlement);
}

function getDelivery(){
	var form = document.frmOrder;
	var obj = form.deliPoli;
	var coupon = 0;
	var emoney = 0;

	var deliPoli = 0;
	for(var i=0;i<obj.length;i++){
		if(obj[i].checked){
			deliPoli = i;
		}
	}
	if( form.coupon ) coupon = form.coupon.value;
	if( form.emoney ) emoney = form.emoney.value;
	var zipcode = form['zipcode[]'][0].value + '-' + form['zipcode[]'][1].value;
	var mode = 'order';
	var road_address = form.road_address.value;
	var address = form.address.value;
	var address_sub = form.address_sub.value;

	$.ajax({
		url : '{_cfg.rootDir}/proc/getdelivery.php',
		type : 'get',
		async : false,
		data : "zipcode="+zipcode+"&deliPoli="+deliPoli+"&coupon="+coupon+"&emoney="+emoney+"&mode="+mode+"&road_address="+road_address+"&address="+address+"&address_sub="+address_sub,
		success : function(res) {
			eval(res);
		}
	});
}


function getCoupon(){

	$('#coupon_list').show();
	$.ajax({
		url : '../proc/coupon_list.php',
		dataType : 'html',
		success : function(result){

			$('#coupon_list').html(result);
		},
		error: function(){
			alert('error');

		}
	});
}

function removeCoupon(){

	$('#coupon_list').html('');
	var apply_coupon = document.getElementById('apply_coupon');
	apply_coupon.innerHTML = '';
	if (typeof document.frmOrder.coupon != 'undefined') document.frmOrder.coupon.value = '0';
	if (typeof document.frmOrder.coupon_emoney != 'undefined') document.frmOrder.coupon_emoney.value = '0';
	chk_emoney(document.frmOrder.emoney);
	getDelivery();
	calcu_settle();
}

/*** 결제수단 첫번째 객체 자동 선택 ***/
window.onload = function (){
	var obj = document.getElementsByName('settlekind');
	for (var i = 0; i < obj.length; i++){
		if (obj[i].checked != true) continue;
		obj[i].onclick();
		var idx = i;
		break;
	}
	if (obj[0] && idx == null){ obj[0].checked = true; obj[0].onclick(); }

	getDelivery();
	$(".m_rightlongtext").css("width", (document.body.clientWidth-70-20-14)+"px");
}


</script>

{ # footer }